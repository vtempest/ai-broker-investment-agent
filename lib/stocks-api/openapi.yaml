openapi: 3.0.3
info:
  title: Stock P/E Calculator API
  description: |
    REST API for retrieving stock quotes, historical price data, and calculating historical P/E ratios.
    
    This API uses Yahoo Finance data to provide:
    - Current stock quotes with financial metrics
    - Historical price data with customizable date ranges and intervals
    - Historical P/E ratio calculations with trailing twelve-month (TTM) EPS
    
    ## Rate Limiting
    This API relies on Yahoo Finance data. Please be respectful of rate limits and avoid excessive requests.
    
    ## Data Intervals
    - `1d` - Daily data (best for short-term analysis, < 1 year)
    - `1wk` - Weekly data (good for medium-term analysis, 1-3 years)
    - `1mo` - Monthly data (best for long-term analysis, > 3 years)
  version: 1.0.0
  contact:
    name: API Support
  license:
    name: MIT

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://api.example.com
    description: Production server

tags:
  - name: Quote
    description: Stock quote and summary data
  - name: Historical
    description: Historical price data
  - name: P/E Ratio
    description: Price-to-Earnings ratio calculations
  - name: Market Discovery
    description: Search, trending, gainers, and screener
  - name: Stock Analysis
    description: Recommendations, insights, options, and charts
  - name: Fundamentals
    description: Fundamental financial data
  - name: System
    description: System health and information
  - name: SEC Filings
    description: SEC EDGAR filing data

paths:
  /:
    get:
      summary: API Information
      description: Get general information about the API and available endpoints
      tags:
        - System
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                type: object
                properties:
                  name:
                    type: string
                    example: Stock P/E Calculator API
                  version:
                    type: string
                    example: 1.0.0
                  description:
                    type: string
                  endpoints:
                    type: object
                  documentation:
                    type: string
                    example: /api-docs

  /api/health:
    get:
      summary: Health Check
      description: Check if the API is running and healthy
      tags:
        - System
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                    description: Server uptime in seconds

  /api/quote/{symbol}:
    get:
      summary: Get Stock Quote
      description: Retrieve current quote summary and financial data for a stock
      tags:
        - Quote
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol (e.g., AAPL, MSFT, GOOGL)
          schema:
            type: string
            example: AAPL
        - name: modules
          in: query
          required: false
          description: Comma-separated list of data modules to retrieve
          schema:
            type: string
            example: price,summaryDetail,defaultKeyStatistics,financialData
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  symbol:
                    type: string
                    example: AAPL
                  data:
                    type: object
                    description: Quote summary data from Yahoo Finance
                  timestamp:
                    type: string
                    format: date-time
              examples:
                apple:
                  summary: Apple Inc. quote
                  value:
                    success: true
                    symbol: AAPL
                    data:
                      price:
                        regularMarketPrice: 150.25
                        currency: USD
                      summaryDetail:
                        marketCap: 2500000000000
                        trailingPE: 28.5
                      defaultKeyStatistics:
                        trailingEps: 5.27
                        forwardPE: 25.3
                      financialData:
                        currentPrice: 150.25
                        targetMeanPrice: 165.00
                    timestamp: "2024-12-02T08:00:00Z"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/historical/{symbol}:
    get:
      summary: Get Historical Price Data
      description: Retrieve historical price data for a stock within a specified date range
      tags:
        - Historical
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
        - name: period1
          in: query
          required: true
          description: Start date in YYYY-MM-DD format
          schema:
            type: string
            format: date
            example: "2024-01-01"
        - name: period2
          in: query
          required: true
          description: End date in YYYY-MM-DD format
          schema:
            type: string
            format: date
            example: "2024-12-31"
        - name: interval
          in: query
          required: false
          description: Data interval
          schema:
            type: string
            enum: [1d, 1wk, 1mo]
            default: 1d
            example: 1mo
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  symbol:
                    type: string
                    example: AAPL
                  period:
                    type: object
                    properties:
                      start:
                        type: string
                        format: date
                      end:
                        type: string
                        format: date
                  interval:
                    type: string
                    example: 1mo
                  dataPoints:
                    type: integer
                    example: 12
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/HistoricalDataPoint'
                  timestamp:
                    type: string
                    format: date-time
              examples:
                monthly:
                  summary: Monthly data for 2024
                  value:
                    success: true
                    symbol: AAPL
                    period:
                      start: "2024-01-01"
                      end: "2024-12-31"
                    interval: 1mo
                    dataPoints: 12
                    data:
                      - date: "2024-01-01T00:00:00.000Z"
                        open: 148.50
                        high: 155.30
                        low: 145.20
                        close: 152.75
                        volume: 125000000
                        adjClose: 152.75
                      - date: "2024-02-01T00:00:00.000Z"
                        open: 153.00
                        high: 158.90
                        low: 150.10
                        close: 157.25
                        volume: 130000000
                        adjClose: 157.25
                    timestamp: "2024-12-02T08:00:00Z"
        '400':
          description: Bad request - missing required parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/search:
    get:
      summary: Search for Symbols
      description: Search for stock symbols, companies, and news
      tags:
        - Market Discovery
      parameters:
        - name: q
          in: query
          required: true
          description: Search query
          schema:
            type: string
            example: apple
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object
                  news:
                    type: array
                    items:
                      type: object

  /api/trending:
    get:
      summary: Get Trending Symbols
      description: Get trending stock symbols for a region
      tags:
        - Market Discovery
      parameters:
        - name: region
          in: query
          required: false
          description: Region code (US, AU, CA, FR, DE, HK, IT, ES, GB, IN)
          schema:
            type: string
            default: US
      responses:
        '200':
          description: Trending symbols
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object

  /api/gainers:
    get:
      summary: Get Daily Gainers
      description: Get top gaining stocks for the day
      tags:
        - Market Discovery
      parameters:
        - name: region
          in: query
          required: false
          description: Region code
          schema:
            type: string
            default: US
        - name: lang
          in: query
          required: false
          description: Language code
          schema:
            type: string
            default: en-US
      responses:
        '200':
          description: Daily gainers
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object

  /api/screener:
    get:
      summary: Stock Screener
      description: Run predefined stock screeners
      tags:
        - Market Discovery
      parameters:
        - name: scrIds
          in: query
          required: true
          description: Screener ID (e.g., day_gainers, most_actives, day_losers)
          schema:
            type: string
            example: day_gainers
      responses:
        '200':
          description: Screener results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object

  /api/pe-ratio/{symbol}:
    get:
      summary: Calculate Historical P/E Ratios
      description: Calculate historical Price-to-Earnings ratios using trailing twelve-month (TTM) EPS
      tags:
        - P/E Ratio
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
        - name: startDate
          in: query
          required: true
          description: Start date in YYYY-MM-DD format
          schema:
            type: string
            format: date
            example: "2023-01-01"
        - name: endDate
          in: query
          required: true
          description: End date in YYYY-MM-DD format
          schema:
            type: string
            format: date
            example: "2024-12-31"
        - name: interval
          in: query
          required: false
          description: Data interval
          schema:
            type: string
            enum: [1d, 1wk, 1mo]
            default: 1mo
            example: 1mo
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  symbol:
                    type: string
                    example: AAPL
                  period:
                    type: object
                    properties:
                      start:
                        type: string
                        format: date
                      end:
                        type: string
                        format: date
                  interval:
                    type: string
                    example: 1mo
                  statistics:
                    $ref: '#/components/schemas/PEStatistics'
                  dataPoints:
                    type: integer
                    example: 24
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PERatioDataPoint'
                  timestamp:
                    type: string
                    format: date-time
              examples:
                twoYears:
                  summary: Two years of monthly P/E ratios
                  value:
                    success: true
                    symbol: AAPL
                    period:
                      start: "2023-01-01"
                      end: "2024-12-31"
                    interval: 1mo
                    statistics:
                      count: 24
                      current: 28.50
                      average: 27.35
                      median: 27.10
                      min: 22.80
                      max: 32.40
                    dataPoints: 24
                    data:
                      - date: "2023-01-01"
                        price: 145.25
                        ttmEPS: 5.35
                        peRatio: 27.15
                      - date: "2023-02-01"
                        price: 148.50
                        ttmEPS: 5.40
                        peRatio: 27.50
                    timestamp: "2024-12-02T08:00:00Z"
        '400':
          description: Bad request - missing required parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/recommendations/{symbol}:
    get:
      summary: Get Recommendations
      description: Get analyst recommendations for a stock
      tags:
        - Stock Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
      responses:
        '200':
          description: Recommendations
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object

  /api/insights/{symbol}:
    get:
      summary: Get Insights
      description: Get research insights for a stock
      tags:
        - Stock Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
      responses:
        '200':
          description: Insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object

  /api/options/{symbol}:
    get:
      summary: Get Options Chain
      description: Get options chain data for a stock
      tags:
        - Stock Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
        - name: date
          in: query
          required: false
          description: Expiration date (timestamp or date string)
          schema:
            type: string
      responses:
        '200':
          description: Options chain
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  expirationDate:
                    type: array
                    items:
                      type: integer
                  strikes:
                    type: array
                    items:
                      type: number
                  options:
                    type: array
                    items:
                      type: object

  /api/chart/{symbol}:
    get:
      summary: Get Advanced Chart
      description: Get advanced chart data with metadata
      tags:
        - Stock Analysis
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
        - name: interval
          in: query
          required: false
          description: Data interval
          schema:
            type: string
            default: 1d
        - name: range
          in: query
          required: false
          description: Data range (1d, 5d, 1mo, 3mo, 6mo, 1y, 2y, 5y, 10y, ytd, max)
          schema:
            type: string
            default: 1mo
      responses:
        '200':
          description: Chart data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  meta:
                    type: object
                  quotes:
                    type: array
                    items:
                      type: object

  /api/fundamentals/{symbol}:
    get:
      summary: Get Fundamentals
      description: Get time-series fundamental data
      tags:
        - Fundamentals
      parameters:
        - name: symbol
          in: path
          required: true
          description: Stock ticker symbol
          schema:
            type: string
            example: AAPL
        - name: period1
          in: query
          required: true
          description: Start date
          schema:
            type: string
            format: date
        - name: period2
          in: query
          required: false
          description: End date
          schema:
            type: string
            format: date
        - name: type
          in: query
          required: false
          description: Report type (quarterly, annual, trailing)
          schema:
            type: string
            default: quarterly
        - name: module
          in: query
          required: false
          description: Module name (financials, balance-sheet, cash-flow, all)
          schema:
            type: string
            default: all
      responses:
        '200':
          description: Fundamental data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  count:
                    type: integer
                  data:
                    type: array
                    items:
                      type: object

  /filings/metadata:
    get:
      summary: Get Filing Metadata
      description: Get metadata for SEC filings based on a query
      tags:
        - SEC Filings
      parameters:
        - name: query
          in: query
          required: true
          description: Query string (e.g., "AAPL/10-K" or accession number)
          schema:
            type: string
            example: AAPL/10-K
        - name: includeAmends
          in: query
          required: false
          description: Whether to include amended filings
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Filing metadata
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FilingMetadata'
        '400':
          description: Missing query parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /filings/download:
    get:
      summary: Download Filing
      description: Download the content of a specific filing
      tags:
        - SEC Filings
      parameters:
        - name: url
          in: query
          required: true
          description: URL of the filing document
          schema:
            type: string
      responses:
        '200':
          description: Filing content
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
            text/html:
              schema:
                type: string
            application/xml:
              schema:
                type: string
        '400':
          description: Missing or invalid URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /filings/html:
    get:
      summary: Get Filing HTML
      description: Get the HTML content of a filing
      tags:
        - SEC Filings
      parameters:
        - name: ticker
          in: query
          required: false
          description: Stock ticker symbol
          schema:
            type: string
        - name: form
          in: query
          required: false
          description: Form type
          schema:
            type: string
        - name: query
          in: query
          required: false
          description: Combined query (e.g., "AAPL/10-K")
          schema:
            type: string
      responses:
        '200':
          description: Filing HTML content
          content:
            text/html:
              schema:
                type: string
        '400':
          description: Missing parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /companies/ticker-mapping:
    get:
      summary: Get Ticker Mapping
      description: Get the mapping of tickers to CIKs
      tags:
        - SEC Filings
      responses:
        '200':
          description: Ticker to CIK mapping
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: string
                  description: CIK number

  /companies/{tickerOrCik}/filings:
    get:
      summary: Get Company Filings
      description: Get a list of filings for a specific company
      tags:
        - SEC Filings
      parameters:
        - name: tickerOrCik
          in: path
          required: true
          description: Stock ticker or CIK number
          schema:
            type: string
        - name: formType
          in: query
          required: false
          description: Filter by form type
          schema:
            type: string
        - name: limit
          in: query
          required: false
          description: Number of filings to return
          schema:
            type: integer
            default: 10
        - name: includeAmends
          in: query
          required: false
          description: Whether to include amended filings
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of filings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FilingMetadata'
        '400':
          description: Missing parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: Invalid stock symbol
        symbol:
          type: string
          example: INVALID

    HistoricalDataPoint:
      type: object
      properties:
        date:
          type: string
          format: date-time
          description: Date of the data point
        open:
          type: number
          format: float
          description: Opening price
        high:
          type: number
          format: float
          description: Highest price
        low:
          type: number
          format: float
          description: Lowest price
        close:
          type: number
          format: float
          description: Closing price
        volume:
          type: integer
          description: Trading volume
        adjClose:
          type: number
          format: float
          description: Adjusted closing price

    PERatioDataPoint:
      type: object
      properties:
        date:
          type: string
          format: date
          description: Date of the data point
        price:
          type: number
          format: float
          description: Stock price (adjusted close)
        ttmEPS:
          type: number
          format: float
          description: Trailing Twelve Month Earnings Per Share
        peRatio:
          type: number
          format: float
          description: Price-to-Earnings Ratio

    PEStatistics:
      type: object
      properties:
        count:
          type: integer
        min:
          type: number
        max:
          type: number
        average:
          type: number
        median:
          type: number
        current:
          type: number

    FilingMetadata:
      type: object
      properties:
        primaryDocUrl:
          type: string
        accessionNumber:
          type: string
        tickers:
          type: array
          items:
            $ref: '#/components/schemas/Ticker'
        companyName:
          type: string
        filingDate:
          type: string
        reportDate:
          type: string
        primaryDocDescription:
          type: string
        items:
          type: string
        formType:
          type: string
        cik:
          type: string

    Ticker:
      type: object
      properties:
        symbol:
          type: string
        exchange:
          type: string
          type: string
          format: date
          description: Date of the calculation
        price:
          type: number
          format: float
          description: Stock price
        ttmEPS:
          type: number
          format: float
          description: Trailing twelve-month earnings per share
        peRatio:
          type: number
          format: float
          description: Price-to-Earnings ratio

    PEStatistics:
      type: object
      properties:
        count:
          type: integer
          description: Number of valid P/E ratio data points
        current:
          type: number
          format: float
          nullable: true
          description: Most recent P/E ratio
        average:
          type: number
          format: float
          description: Average P/E ratio
        median:
          type: number
          format: float
          description: Median P/E ratio
        min:
          type: number
          format: float
          description: Minimum P/E ratio
        max:
          type: number
          format: float
          description: Maximum P/E ratio
